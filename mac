#!/bin/sh

# Check if Homebrew is installed.
if ! type "brew" > /dev/null; then
  echo "ðŸš€ Installing homebrew."
  /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"

  echo "ðŸš€ Installing basic formulas."
  brew install git
  brew install vim
  brew install zsh
  brew install tree
  brew install lazygit
  brew install rbenv
  brew install pyenv
fi

echo "ðŸš€ Updating homebrew."
brew update
brew upgrade

echo "ðŸš€ Setup dotfiles."

# Clean dotfiles
rm -f "$HOME/.gemrc"
rm -f "$HOME/.gitconfig"
rm -f "$HOME/.gitignore"
rm -f "$HOME/.vimrc"
rm -f "$HOME/.zshrc"

# Link dotfiles
ln -s "$PWD/dotfiles/gemrc" "$HOME/.gemrc"
ln -s "$PWD/dotfiles/gitconfig" "$HOME/.gitconfig"
ln -s "$PWD/dotfiles/gitignore" "$HOME/.gitignore"
ln -s "$PWD/dotfiles/vimrc" "$HOME/.vimrc"
ln -s "$PWD/dotfiles/zshrc" "$HOME/.zshrc"

# Create vim extra folders
mkdir -p "$HOME/.vim/swap"
mkdir -p "$HOME/.vim/backup"

# Check if Vundle (VIM dependency manager) is installed
if [ ! -d "$HOME/.vim/bundle/Vundle.vim" ]; then
  echo "ðŸš€ Installing Vundle."
  git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim
fi

# Install all vim depdendencies
echo "ðŸš€ Updating Vundle."
vim +PluginInstall +qall

# Check if Antibody (Zsh dependency manager) is installed.
if ! type "antibody" > /dev/null; then
  echo "ðŸš€ Installing Antibody."
  curl -sfL git.io/antibody | sh -s - -b /usr/local/bin
  antibody bundle
fi

echo "ðŸš€ Updating Antibody."
antibody update

# Download terminal custom theme and setup custom configuration
echo "ðŸš€ Configuring Terminal."
rm "$HOME/Library/Preferences/com.apple.Terminal.plist"
ln -s "$PWD/config/com.apple.Terminal.plist" "$HOME/Library/Preferences/com.apple.Terminal.plist"
